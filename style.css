/* style.css */

/* =========================================
   1. Reset & Variables
   ========================================= */
* { box-sizing: border-box; }

:root {
    /* --- Light Mode (Default) --- */
    --bg-body: #f0f2f5;
    --bg-panel: #ffffff;
    --text-main: #333333;
    --text-sub: #666666;
    --border-color: #cccccc;
    --border-light: #eeeeee;
    --wall-color: #000000;
    --grid-line: #f0f0f0;
    --btn-bg: #ffffff;
    --btn-hover: #e9ecef;
    --btn-text: #444444;
    --primary: #28a745;
    --primary-hover: #218838;
    --danger: #dc3545;
    --active: #007bff;
    --start-bg: #4ade80;
    --goal-bg: #f87171;
    --path-bg: rgba(255, 235, 59, 0.7);
    --sidebar-width: 340px;
    --cell-size: 30px;
    --cols: 16;
    --rows: 16;
}

/* --- Dark Mode Variables (Keep Original) --- */
@media (prefers-color-scheme: dark) {
    :root {
        --bg-body: #121212;
        --bg-panel: #1e1e1e;
        --text-main: #e0e0e0;
        --text-sub: #a0a0a0;
        --border-color: #444444;
        --border-light: #333333;
        --wall-color: #ff4d4d;
        --grid-line: #2c2c2c;
        --btn-bg: #2d2d2d;
        --btn-hover: #3d3d3d;
        --btn-text: #e0e0e0;
        --primary: #1e7e34;
        --primary-hover: #155724;
        --danger: #bd2130;
        --active: #0056b3;
        --path-bg: rgba(255, 215, 0, 0.5);
    }
    :root:not([data-theme="light"]) .cell.is-start.wall-n,
    :root:not([data-theme="light"]) .cell.is-goal.wall-n { border-top-color: #FFD700 !important; }
    :root:not([data-theme="light"]) .cell.is-start.wall-e,
    :root:not([data-theme="light"]) .cell.is-goal.wall-e { border-right-color: #FFD700 !important; }
    :root:not([data-theme="light"]) .cell.is-start.wall-s,
    :root:not([data-theme="light"]) .cell.is-goal.wall-s { border-bottom-color: #FFD700 !important; }
    :root:not([data-theme="light"]) .cell.is-start.wall-w,
    :root:not([data-theme="light"]) .cell.is-goal.wall-w { border-left-color: #FFD700 !important; }
}

[data-theme="dark"] {
    --bg-body: #121212;
    --bg-panel: #1e1e1e;
    --text-main: #e0e0e0;
    --text-sub: #a0a0a0;
    --border-color: #444444;
    --border-light: #333333;
    --wall-color: #ff4d4d;
    --grid-line: #2c2c2c;
    --btn-bg: #2d2d2d;
    --btn-hover: #3d3d3d;
    --btn-text: #e0e0e0;
    --primary: #1e7e34;
    --danger: #bd2130;
    --active: #0056b3;
    --path-bg: rgba(255, 215, 0, 0.5);
}

[data-theme="light"] {
    --bg-body: #f0f2f5;
    --bg-panel: #ffffff;
    --text-main: #333333;
    --text-sub: #666666;
    --border-color: #cccccc;
    --border-light: #eeeeee;
    --wall-color: #000000;
    --grid-line: #f0f0f0;
    --btn-bg: #ffffff;
    --btn-hover: #e9ecef;
    --btn-text: #444444;
    --primary: #28a745;
    --danger: #dc3545;
    --active: #007bff;
    --path-bg: rgba(255, 235, 59, 0.7);
}

/* =========================================
   2. Base Layout (CSS Grid) - REFACTORED
   ========================================= */
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: var(--bg-body);
    color: var(--text-main);
    margin: 0;
    width: 100%;
    height: 100dvh;   /* ä½¿ç”¨ dvh å‹•æ…‹é«˜åº¦ï¼Œé©é… iOS å·¥å…·åˆ—ä¼¸ç¸® */
    position: fixed;  /* â˜… é—œéµï¼šå¼·åˆ¶å›ºå®šä½ç½®ï¼Œé˜²æ­¢åˆ‡æ› App æ™‚ç‰ˆé¢è·‘æ‰ */
    inset: 0;         /* ä¸Šä¸‹å·¦å³è²¼é½Š */
    overflow: hidden; /* ç¦æ­¢ body æ²å‹• */
    
    display: grid;
    grid-template-rows: max-content 1fr; /* é…åˆä¸Šä¸€é¡Œæ”¹çš„è¨­å®š */
    grid-template-columns: var(--sidebar-width) 1fr;
    grid-template-areas: 
        "header header"
        "sidebar main";
    transition: all 0.3s ease;
}

/* ç‹€æ…‹ï¼šå´é‚Šæ¬„é—œé–‰ (Desktop) */
body.sidebar-closed {
    /* è®“å´é‚Šæ¬„æ¬„ä½æ­¸é›¶ï¼Œå…§å®¹å€ (1fr) è‡ªå‹•å¡«æ»¿ */
    grid-template-columns: 0 1fr;
}

/* --- Top Bar (Header) --- */
.top-bar {
    grid-area: header;
    background-color: var(--bg-panel);
    border-bottom: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    
    /* â˜… ä½¿ç”¨ relative è®“å…§éƒ¨çš„çµ•å°å®šä½å…ƒç´ åƒè€ƒé€™è£¡ */
    position: relative; 
    
    /* ğŸŸ¢ ä¿®æ”¹ padding-topï¼ŒåŠ å€‹ä¿éšª */
    /* æ„æ€æ˜¯ï¼šå–ã€Œå®‰å…¨å€åŸŸã€è·Ÿã€Œ10pxã€ä¹‹ä¸­æ¯”è¼ƒå¤§çš„é‚£å€‹ */
    /* é€™æ¨£å°±ç®— Safari èª¤åˆ¤å®‰å…¨å€åŸŸç‚º 0ï¼Œè‡³å°‘é‚„æœ‰ 10px çš„ç¸«éš™ï¼Œä¸æœƒå®Œå…¨é»åœ¨å‹•æ…‹å³¶ä¸Š */
    padding-top: max(10px, env(safe-area-inset-top)); 
    
    /* å…¶ä»– padding ä¿æŒä¸è®Š */
    padding-right: max(15px, env(safe-area-inset-right));
    padding-left: max(60px, env(safe-area-inset-left));
    padding-bottom: 0;

    height: auto;
    min-height: 50px; 
    
    gap: 10px;
    z-index: 50;
    overflow: hidden;
}

/* è¨­å®šæ¨™é¡Œæ–‡å­— */
.top-bar h1 {
    margin: 0;
    font-size: 1.2rem;
    margin-right: auto; /* æŠŠå³é‚Šçš„æ±è¥¿æ¨åˆ°åº• */
    
    /* â˜… ä¿®æ”¹é‡é» 4: é˜²æ­¢æ¨™é¡ŒæŠŠå³é‚Šæ“ å‡ºå» */
    white-space: nowrap;       /* æ–‡å­—ä¸æ›è¡Œ */
    overflow: hidden;          /* è¶…å‡ºé•·åº¦éš±è— */
    text-overflow: ellipsis;   /* è¶…å‡ºè®Šæˆ ... */
    min-width: 0;              /* é—œéµï¼šå…è¨± Flex å­å…ƒç´ ç¸®å°åˆ°æ¯”å…§å®¹é‚„å° */
    flex-shrink: 1;            /* å…è¨±æ¨™é¡Œè¢«å£“ç¸® */
}

/* è¨­å®šå³ä¸Šçš„ä¸‹æ‹‰é¸å–® */
.theme-select, .lang-select {
    /* â˜… ä¿®æ”¹é‡é» 5: ç¦æ­¢ä¸‹æ‹‰é¸å–®è¢«å£“ç¸®ï¼Œç¢ºä¿å®ƒå€‘æ°¸é åœ¨ç•«é¢ä¸Š */
    flex-shrink: 0; 
    max-width: 120px; /* é¿å…é¸å–®æœ¬èº«å¤ªå¯¬ */
}


/* =========================================
   Theme Toggle Switch (ç²¾æº–è¦†è“‹ç‰ˆ)
   ========================================= */
.theme-switch-wrapper {
    display: flex;
    align-items: center;
    margin-right: 15px;
}

.theme-switch {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 30px;
    flex-shrink: 0;
}

.theme-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

/* æ»‘è»ŒèƒŒæ™¯ */
.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #87CEEB; /* æ·ºè‰²ï¼šå¤©è— */
    transition: .4s;
    border-radius: 34px;
    border: 1px solid var(--border-color);
    overflow: hidden; /* é—œéµï¼šç¢ºä¿åœ“çƒè·‘å‡ºå»æ™‚ä¸æœƒç ´åœ– */
}

/* åœ“çƒæŒ‰éˆ• (åŠ å¤§ç‰ˆ) */
.slider:before {
    position: absolute;
    content: "";
    
    /* â˜… ä¿®æ”¹ 1: åŠ å¤§åœ“çƒï¼Œç¢ºä¿èƒ½å®Œå…¨è“‹ä½åœ–ç¤º */
    height: 26px; 
    width: 26px;
    
    /* è¨ˆç®—ä½ç½®: (30pxé«˜åº¦ - 26pxåœ“çƒ) / 2 = 2px */
    left: 2px;
    bottom: 1px; 
    
    background-color: white;
    transition: .4s;
    border-radius: 50%;
    z-index: 2; /* ç¢ºä¿åœ“çƒè“‹åœ¨åœ–ç¤ºä¸Šé¢ */
    box-shadow: 0 2px 4px rgba(0,0,0,0.25);
}

/* æ·±è‰²æ¨¡å¼ç‹€æ…‹ */
input:checked + .slider {
    background-color: #2c3e50; /* æ·±è‰²ï¼šå¤œç©ºé»‘ */
    border-color: #555;
}

/* åœ“çƒç§»å‹•è·é›¢ */
input:checked + .slider:before {
    /* ç¸½å¯¬ 60 - åœ“çƒ 26 - å·¦é‚Šè· 2 - å³é‚Šè· 2 = 30px */
    transform: translateX(30px);
}

/* --- åœ–ç¤ºæ¨£å¼ (æ”¹ç‚ºçµ•å°å®šä½) --- */
.icon-sun, .icon-moon {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    
    /* â˜… ä¿®æ”¹ 2: å­—é«”ç¨å¾®ç¸®å°ï¼Œç¢ºä¿ä¸æœƒè¶…å‡ºåœ“çƒ */
    font-size: 14px; 
    line-height: 1;
    z-index: 1; /* åœ¨åœ“çƒä¸‹é¢ */
    user-select: none;
    pointer-events: none;
}

/* â˜… ä¿®æ”¹ 3: ç²¾æº–å®šä½åœ–ç¤ºä½ç½® */
.icon-sun {
    /* å¤ªé™½æ”¾åœ¨å·¦é‚Š (æ·ºè‰²æ¨¡å¼æ™‚è¢«åœ“çƒè“‹ä½? ä¸ï¼Œé€šå¸¸è¨­è¨ˆæ˜¯åœ“çƒåœ¨å¤ªé™½ä½ç½®ä»£è¡¨é¸ä¸­å¤ªé™½) */
    /* ä¾ç…§ä½ çš„é‚è¼¯ï¼šåœ“çƒåœ¨å·¦ = æ·ºè‰² = åœ“çƒè¦æ˜¯å¤ªé™½? é‚„æ˜¯åœ“çƒæ—é‚Šé¡¯ç¤ºå¤ªé™½? */
    /* é€™è£¡è¨­å®šï¼šåœ–ç¤ºæ°¸é å›ºå®šåœ¨å·¦å³å…©é‚Šï¼Œåœ“çƒæ»‘éå»è“‹ä½å®ƒ */
    
    left: 7px; /* (åœ“çƒ26 - å­—é«”14)/2 + é‚Šè·2 â‰ˆ 7~8px */
    color: #fff;
    text-shadow: 0 0 2px #FFD700;
}

.icon-moon {
    right: 7px; /* åŒä¸Šï¼Œç¢ºä¿å±…ä¸­ */
}

/* =========================================
   Toggle Switch UI (é€šç”¨é–‹é—œæ¨£å¼)
   ========================================= */
.toggle-control {
    display: flex;
    align-items: center;
    cursor: pointer;
    margin-bottom: 8px; /* é¸é …ä¹‹é–“çš„é–“è· */
    user-select: none;
    position: relative;
}

/* éš±è—åŸå§‹çš„ checkbox */
.toggle-control input {
    opacity: 0;
    width: 0;
    height: 0;
    position: absolute;
}

/* æ»‘è»ŒèƒŒæ™¯ */
.toggle-slider {
    position: relative;
    width: 44px;
    height: 24px;
    background-color: #ccc; /* æœªé¸å–æ™‚çš„ç°è‰² */
    border-radius: 24px;
    transition: 0.3s;
    margin-right: 12px; /* é–‹é—œèˆ‡æ–‡å­—çš„è·é›¢ */
    flex-shrink: 0;
}

/* æ·±è‰²æ¨¡å¼ä¸‹çš„æœªé¸å–èƒŒæ™¯ */
[data-theme="dark"] .toggle-slider {
    background-color: #555;
}

/* åœ“å½¢æŒ‰éˆ• (Knob) */
.toggle-slider::before {
    content: "";
    position: absolute;
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    border-radius: 50%;
    transition: 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

/* é¸å–ç‹€æ…‹ (Checked) - èƒŒæ™¯è®Šè‰² */
.toggle-control input:checked + .toggle-slider {
    background-color: var(--primary); /* ä½¿ç”¨ä½ çš„ä¸»é¡Œç¶ è‰² */
}

/* é¸å–ç‹€æ…‹ (Checked) - æŒ‰éˆ•ç§»å‹• */
.toggle-control input:checked + .toggle-slider::before {
    transform: translateX(20px);
}

/* æ–‡å­—æ¨™ç±¤æ¨£å¼ */
.toggle-text {
    font-size: 14px;
    color: var(--text-main);
}

/* --- Global Toggle Button --- */
.sidebar-toggle {
    /* â˜… ä¿®æ”¹é‡é» 3: æ”¹ç‚ºçµ•å°å®šä½ï¼Œå›ºå®šåœ¨å·¦å´ */
    position: absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%); /* è®“å®ƒå‚ç›´ç½®ä¸­ */
    
    width: 40px;
    height: 40px;
    font-size: 26px;
    border-radius: 50%;
    border: none;
    background: transparent;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    color: var(--text-main);
    transition: background-color 0.2s;
    z-index: 55;
}

.sidebar-toggle:hover {
    background-color: var(--btn-hover);
}

/* --- Main View --- */
.main-view {
    grid-area: main;
    background-color: var(--bg-body);
    position: relative;
    overflow: auto;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

/* =========================================
   3. Sidebar Styles - REFACTORED
   ========================================= */
#sidebar {
    grid-area: sidebar;
    /* å¯¬åº¦ç”± Grid æ§åˆ¶ï¼Œé€™è£¡åªè¦è¨­å®š 100% å¡«æ»¿ Grid Cell å³å¯ */
    width: 100%; 
    height: 100%;
    background-color: var(--bg-panel);
    border-right: 1px solid var(--border-color);
    display: flex;
    flex-direction: column;
    /* ç§»é™¤ transition widthï¼Œæ”¹ç”± body grid transition æ§åˆ¶ */
    overflow: hidden; /* ç¢ºä¿ç¸®å°æ™‚å…§å®¹ä¸æº¢å‡º */
    position: relative;
    z-index: 40; /* æ¯” Header ä½ä¸€é» */
}

.sidebar-scroll-area {
    flex: 1;
    overflow-y: auto;
    overflow-x: hidden;
    padding-top: 10px;
    
    /* 1. é è¨­çµ¦ä¸€é»åº•éƒ¨ç©ºé–“ */
    padding-bottom: 20px; 
    
    opacity: 1;
    transition: opacity 0.2s;
    
    /* å„ªåŒ–æ‰‹æ©Ÿæ²å‹•æ‰‹æ„Ÿ */
    -webkit-overflow-scrolling: touch; 
}

/* ç•¶ Sidebar è¢«å£“ç¸®æ™‚éš±è—å…§å®¹ */
body.sidebar-closed #sidebar .sidebar-scroll-area {
    opacity: 0;
    pointer-events: none;
    visibility: hidden;
}

/* å…§éƒ¨å…ƒä»¶æ¨£å¼ (ä¿æŒåŸæ¨£) */
.controls-content { padding: 15px; display: flex; flex-direction: column; gap: 10px; }
.input-group { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; background: rgba(0, 0, 0, 0.03); padding: 10px; border-radius: 8px; border: 1px solid var(--border-light); width: 100%; margin-bottom: 15px; }
.file-panel { display: flex; flex-direction: column; gap: 8px; border: 1px solid var(--border-light); padding: 10px; border-radius: 8px; background-color: rgba(0,0,0,0.02); margin-bottom: 10px; animation: fadeIn 0.3s; }
.control-group { display: flex; flex-direction: column; gap: 12px; background-color: rgba(0, 0, 0, 0.02); border: 1px solid var(--border-light); border-radius: 8px; padding: 15px; margin-top: 5px; }

/* =========================================
   4. Maze Grid & Visualization (Keep Original)
   ========================================= */
.layout-wrapper {
    flex: 1;
    width: 100%;
    height: 100%;
    background-color: var(--bg-body);
    position: relative;
    overflow: hidden; /* â˜… é‡è¦ï¼šæŠŠè·‘å‡ºå»çš„è¿·å®®è—èµ·ä¾† */
    
    /* è®“å…§å®¹é è¨­å±…ä¸­ */
    display: flex;
    justify-content: center;
    align-items: center;
    
    /* ç¦æ­¢ç€è¦½å™¨é è¨­è§¸æ§è¡Œç‚º */
    touch-action: none;
    cursor: grab; /* é è¨­æ‰‹å‹ */
}

.layout-wrapper.grabbing {
    cursor: grabbing; /* æŠ“å–æ™‚çš„æ‰‹å‹ */
}

/* âœ… æ–°å¢ï¼šå…§å±¤å®¹å™¨ (è² è²¬ Grid æ’ç‰ˆèˆ‡ç§»å‹•) */
.maze-container {
    display: grid;
    /* åŸæœ¬åœ¨ layout-wrapper çš„ grid è¨­å®šæ¬ä¾†é€™è£¡ */
    grid-template-columns: max-content max-content;
    grid-template-rows: max-content max-content;
    justify-content: center;
    align-content: center;
    
    /* ç§»å‹•çš„æ ¸å¿ƒï¼šTransform */
    transform-origin: center center;
    /* å¦‚æœæƒ³è¦çµ²æ»‘ä¸€é»å¯ä»¥åŠ  transitionï¼Œä½†åœ¨æ‹–æ›³æ™‚å»ºè­°ä¸è¦åŠ å¤ªå¼·çš„å»¶é² */
    /* transition: transform 0.1s linear; */ 
}
.layout-wrapper.grab-mode { cursor: grab; }
.layout-wrapper.grabbing { cursor: grabbing; }
.y-axis { grid-row: 1; grid-column: 1; display: grid; grid-template-rows: repeat(var(--rows), var(--cell-size)); align-items: center; justify-items: end; padding-right: 8px; font-size: 12px; }
.x-axis-wrapper { grid-row: 2; grid-column: 2; display: grid; grid-template-columns: repeat(var(--cols), var(--cell-size)); justify-items: center; font-size: 12px; margin-top: 5px; }
.y-axis div, .x-axis-wrapper div { color: var(--text-sub); font-weight: bold; white-space: nowrap; }
/* 1. å®¹å™¨è¨­å®šï¼šèª¿æ•´é«˜åº¦èˆ‡å¤–è· */
.x-axis-wrapper.rotate-mode {
    /* â˜… é—œéµ 1ï¼šç”¨è² çš„ margin æŠŠæ•´æ’æ•¸å­—å¾€ä¸Šæ‹‰ï¼Œé è¿‘è¿·å®® */
    margin-top: -7px; 
    
    /* çµ¦äºˆè¶³å¤ é«˜åº¦ï¼Œç¢ºä¿çªå‡ºçš„é•·æ•¸å­—ä¸æœƒè¢«åˆ‡æ‰ */
    height: 40px; 
    
    /* ç¢ºä¿å‚ç›´å°é½Š */
    align-items: start; 
}

/* 2. æ•¸å­—è¨­å®šï¼šæ—‹è½‰ä¸¦å¾®èª¿ä½ç½® */
.x-axis-wrapper.rotate-mode div {
    transform-origin: center center;
    
    /* â˜… é—œéµä¿®æ­£ï¼šæ”¹æˆè² æ•¸ï¼Œæˆ–è€…ç›´æ¥æ­¸é›¶ */
    /* translateX(-15px) ä»£è¡¨ã€Œå¾€ä¸‹ã€ç§»å‹• (å› ç‚ºæ—‹è½‰å¾Œ X è»¸æœä¸Š) */
    transform: rotate(-90deg) translateX(-15px);

    width: var(--cell-size);
    text-align: center;
    font-size: 10px;
    line-height: var(--cell-size);
    position: relative;
}
#maze-grid { grid-row: 1; grid-column: 2; display: grid; grid-template-columns: repeat(var(--cols), var(--cell-size)); grid-template-rows: repeat(var(--rows), var(--cell-size)); background-color: var(--bg-panel); user-select: none; -webkit-user-select: none; position: relative; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
#maze-grid.editing-wall .cell { cursor: crosshair; }
.cell { width: var(--cell-size); height: var(--cell-size); border: 1px solid var(--grid-line); position: relative; cursor: pointer; transition: var(--cell-transition, background-color 0.15s ease-out); }
.cell:hover { background-image: linear-gradient(rgba(0,0,0,0.1), rgba(0,0,0,0.1)); }
.cell.searching, .cell.path-node { transition: background-color 0.2s ease-in; }
.wall-n { border-top: 2px solid var(--wall-color); }
.wall-e { border-right: 2px solid var(--wall-color); }
.wall-s { border-bottom: 2px solid var(--wall-color); }
.wall-w { border-left: 2px solid var(--wall-color); }
.is-start { background-color: var(--start-bg) !important; }
.is-goal { background-color: var(--goal-bg) !important; }
.is-start::after { content: 'S'; color: white; font-weight: bold; font-size: 12px; position:absolute; inset:0; display:flex; justify-content:center; align-items:center;}
.is-goal::after { content: 'G'; color: white; font-weight: bold; font-size: 12px; position:absolute; inset:0; display:flex; justify-content:center; align-items:center;}
/* â˜…â˜…â˜… ä¿®æ”¹å¦‚ä¸‹ï¼šå¢åŠ å¹³æ»‘è½‰å ´ â˜…â˜…â˜… */
.cell.searching { 
    background-color: rgba(33, 150, 243, 0.5) !important; /* æ·ºè—è‰² */
    
    /* å¢åŠ  transform è®“æ ¼å­æœ‰å¾®å¾®å½ˆå‡ºçš„æ„Ÿè¦ºï¼Œçœ‹èµ·ä¾†æ›´æ´»æ½‘ */
    transform: scale(0.95); 
    border-radius: 4px;
    
    /* è®“é¡è‰²è®ŠåŒ–æœ‰ 0.3ç§’ çš„æ¼¸è®Šï¼Œæ¶ˆé™¤é–ƒçˆæ„Ÿ */
    transition: background-color 0.3s ease-out, transform 0.2s ease-out; 
}

/* æ·±è‰²æ¨¡å¼ä¹Ÿè¦æ”¹ */
[data-theme="dark"] .cell.searching { 
    background-color: #01579b !important; 
    transition: background-color 0.3s ease-out, transform 0.2s ease-out; 
}
.cell.current-head { background-color: #ff9800 !important; border: 2px solid #fff; z-index: 30; }
/* ä¿®æ”¹é€™ä¸€æ®µ */
.cell.backtracking { 
    /* 1. ä¿æŒåŸæ¨£å¤§å° */
    transform: none !important; 
    border-radius: 0 !important;
    
    /* â˜… é—œéµä¿®æ­£ï¼šåˆªé™¤åŸæœ¬é€™è£¡çš„ border è¨­å®š */
    /* ä¸è¦å¯« border: ... !importantï¼Œé€™æ¨£æ‰èƒ½ä¿ç•™ç‰†å£æ¨£å¼ (.wall-n ç­‰) */
    
    /* 2. èƒŒæ™¯è‰²ï¼šæ·¡ç´…è‰² */
    background-color: #ffcdd2 !important; 
    
    /* 3. è½‰å ´æ•ˆæœ */
    transition: background-color 0.2s;
    
    /* ç¢ºä¿è£¡é¢å¯ä»¥å®šä½å‰å‰ */
    position: relative;
    z-index: 0; /* ç¢ºä¿ä¸æœƒè“‹ä½é‚Šæ¡† */
}

/* 4. åˆ©ç”¨å½å…ƒç´ åŠ ä¸€å€‹ã€Œå‰å‰ã€ */
.cell.backtracking::after {
    content: "âœ•"; 
    position: absolute;
    inset: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    
    color: #c62828;  /* æ·±ç´…è‰² */
    font-size: 1.2em; 
    font-weight: bold;
    opacity: 0.6;   
    
    animation: fadeIn 0.2s ease-out;
}

/* --- æ·±è‰²æ¨¡å¼å¾®èª¿ --- */
[data-theme="dark"] .cell.backtracking { 
    background-color: #4a1818 !important; /* æ·±æš—ç´…åº• */
}
/* æ³¨æ„ï¼šé€™è£¡ä¹Ÿä¸è¦åŠ  border è¨­å®šï¼Œè®“å®ƒè‡ªå‹•é¡¯ç¤ºäº®ç´…è‰²çš„ç‰†å£ */

[data-theme="dark"] .cell.backtracking::after {
    color: #ff5252; 
    opacity: 0.8;
}

.cell-weight { position: absolute; inset: 0; display: flex; justify-content: center; align-items: center; font-size: 10px; color: var(--text-sub); z-index: 20 !important; pointer-events: none; font-weight: bold; text-shadow: 1px 1px 0 rgba(255,255,255,0.8); display: none; }
[data-theme="dark"] .cell-weight { color: #fff; text-shadow: 1px 1px 0 rgba(0,0,0,0.8); }
#maze-grid.show-weights .cell-weight { display: flex; }
.maze-svg-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
.path-line { fill: none; stroke-width: 2px; vector-effect: non-scaling-stroke; stroke-linecap: round; stroke-linejoin: round; opacity: 0.9; filter: drop-shadow(0px 1px 1px rgba(0,0,0,0.3)); z-index: 10; }
.path-dashed { fill: none; stroke-width: 1.5px; vector-effect: non-scaling-stroke; stroke-dasharray: 4, 4; stroke-linecap: round; stroke-linejoin: round; opacity: 0.7; z-index: 9; }

/* --- Info/Status Container --- */
.info-container {
    position: fixed; 
    bottom: 20px; 
    right: 20px;
    background-color: var(--bg-panel); 
    padding: 8px 15px;
    border-radius: 8px; 
    border: 1px solid var(--border-color);
    box-shadow: 0 4px 15px rgba(0,0,0,0.15);
    z-index: 60;
    
    /* é è¨­å®Œå…¨ä¸é€æ˜ */
    opacity: 1; 
    transition: opacity 0.3s ease;
    pointer-events: auto; /* é è¨­å¯ä»¥é»æ“Šé¸å–æ–‡å­— */
}

/* âŒ åˆªé™¤åŸæœ¬çš„ .info-container:hover {...} */

/* âœ… æ–°å¢ï¼šç”± JS æ§åˆ¶çš„é‡ç–Šç‹€æ…‹ */
.info-container.is-overlapping {
    /* ç•¶é‡ç–Šæ™‚ï¼Œè®ŠåŠé€æ˜ */
    opacity: 0.2; 
    
    /* è®“æ»‘é¼ é»æ“Šç©¿é€ï¼ˆé€™æ¨£æ‰èƒ½é»åˆ°åº•ä¸‹çš„è¿·å®®æ ¼å­ï¼‰ */
    pointer-events: none; 
}

.status-text { font-size: 0.9em; color: var(--text-main); }

/* =========================================
   5. UI Components (Keep Original)
   ========================================= */
input[type="number"], select { background: var(--bg-panel); color: var(--text-main); border: 1px solid var(--border-color); padding: 5px; border-radius: 4px; }
.theme-select, .lang-select { padding: 5px; border-radius: 4px; border: 1px solid var(--border-color); background: var(--bg-panel); color: var(--text-main); }
.slider-container { width: 100%; display: flex; align-items: center; }
.slider-container input { width: 100%; }
button { padding: 8px 12px; cursor: pointer; border: 1px solid var(--border-color); border-radius: 6px; background-color: var(--btn-bg); color: var(--btn-text); transition: all 0.2s; font-size: 14px; white-space: nowrap; flex: 1 1 auto; display: inline-flex; justify-content: center; align-items: center; gap: 5px; }
button:hover { background-color: var(--btn-hover); }
button.active { background-color: var(--active); color: white; border-color: var(--active); }
button.primary { background-color: var(--primary); color: white; border: none; }
button.primary:hover { background-color: var(--primary-hover); }
button.danger { color: var(--danger); border-color: var(--danger); background: transparent; }
button.danger:hover { background-color: var(--danger); color: white; }
.btn-row { display: flex; flex-direction: row; justify-content: space-between; gap: 8px; width: 100%; }
.btn-row button { flex: 1; }
.file-btn { width: 100% !important; text-align: center; margin-bottom: 8px; padding: 10px 15px; display: flex; justify-content: center; align-items: center; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
@keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }


/* =========================================
   Language Selector (åŠ å¤§ç¾åŒ–ç‰ˆ)
   ========================================= */
.lang-select {
    /* 1. å°ºå¯¸æ”¾å¤§ */
    height: 40px;           /* å¢åŠ é«˜åº¦ (åŸæœ¬ç´„ 20-30px) */
    font-size: 16px;        /* å­—é«”è®Šå¤§ (åŸæœ¬é è¨­é€šå¸¸æ˜¯ 13px) */
    font-weight: 500;       /* å­—é«”ç¨å¾®åŠ ç²— */
    padding: 0 12px;        /* å¢åŠ å·¦å³ç•™ç™½ */
    
    /* 2. å¯¬åº¦èª¿æ•´ */
    min-width: 140px;       /* è¨­å®šæœ€å°å¯¬åº¦ï¼Œç¢ºä¿æ–‡å­—ä¸æŠ˜è¡Œ */
    max-width: none;        /* â˜… é‡è¦ï¼šç§»é™¤åŸæœ¬ 120px çš„é™åˆ¶ */
    flex-shrink: 0;         /* é˜²æ­¢è¢«æ“ å£“ */
    
    /* 3. å¤–è§€ç¾åŒ– */
    border: 1px solid var(--border-color);
    border-radius: 8px;     /* åœ“è§’æ›´åœ“æ½¤ */
    background-color: var(--bg-panel);
    color: var(--text-main);
    cursor: pointer;
    outline: none;          /* ç§»é™¤é»æ“Šæ™‚çš„è—æ¡† */
    
    /* 4. æ·»åŠ é™°å½±èˆ‡è½‰å ´æ•ˆæœ */
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    transition: all 0.2s ease;
    
    /* è®“æ–‡å­—å‚ç›´ç½®ä¸­ */
    display: flex;
    align-items: center;
}

/* æ»‘é¼ æ‡¸åœæ•ˆæœ */
.lang-select:hover {
    border-color: var(--primary);       /* é‚Šæ¡†è®Šç¶ è‰² */
    background-color: var(--bg-body);   /* èƒŒæ™¯ç¨å¾®è®Šæ·± */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

/* é»æ“Š/èšç„¦æ•ˆæœ */
.lang-select:focus {
    border-color: var(--primary);
    /* åŠ ä¸€åœˆæ·¡ç¶ è‰²çš„å…‰æšˆï¼Œæå‡æ“ä½œæ„Ÿ */
    box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.2); 
}

/* =========================================
   Sidebar Selects (å´é‚Šæ¬„ä¸‹æ‹‰é¸å–®ç¾åŒ–)
   ========================================= */
#algo-select, 
#map-select, 
#size-preset {
    /* 1. å°ºå¯¸æ”¾å¤§ */
    height: 38px;           /* é«˜åº¦å¢åŠ ï¼Œå¥½é»æ“Š */
    font-size: 14px;        /* å­—é«”é©ä¸­ */
    padding: 0 10px;        /* å…§è· */
    
    /* 2. å¤–è§€ç¾åŒ– */
    border: 1px solid var(--border-color);
    border-radius: 6px;
    background-color: var(--bg-panel);
    color: var(--text-main);
    cursor: pointer;
    outline: none;
    
    /* 3. æ’ç‰ˆ */
    flex: 1;                /* è‡ªå‹•å¡«æ»¿å‰©é¤˜ç©ºé–“ */
    min-width: 0;           /* é˜²æ­¢è¢«æ’é–‹ */
    
    /* 4. é™°å½±èˆ‡è½‰å ´ */
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    transition: all 0.2s ease;
}

/* æ»‘é¼ æ‡¸åœ */
#algo-select:hover, 
#map-select:hover, 
#size-preset:hover {
    border-color: var(--primary);
    background-color: var(--bg-body);
}

/* é»æ“Šèšç„¦ */
#algo-select:focus, 
#map-select:focus, 
#size-preset:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.15); /* æ·¡ç¶ è‰²å…‰æšˆ */
}

/* =========================================
   6. Responsive Design (Mobile) - REFACTORED
   ========================================= */
@media (max-width: 768px) {
    body {
        /* æ‰‹æ©Ÿç‰ˆï¼šæ°¸é ä¿æŒå–®æ¬„ï¼Œä¸ç®¡é¸å–®æœ‰æ²’æœ‰é–‹ */
        grid-template-columns: 1fr;
        grid-template-rows: max-content 1fr;
        grid-template-areas: 
            "header"
            "main";
    }

    /* â˜… é—œéµä¿®å¾©ï¼šè¦†è“‹æ‰æ¡Œæ©Ÿç‰ˆçš„è¨­å®š */
    /* æ¡Œæ©Ÿç‰ˆèªªé—œé–‰æ™‚è¦è®Šæˆ 0 1frï¼Œä½†æ‰‹æ©Ÿç‰ˆæˆ‘å€‘å¼·è¿«å®ƒä¿æŒ 1fr */
    body.sidebar-closed {
        grid-template-columns: 1fr;
    }

    .top-bar {
        padding-left: 60px; /* ç•™ä½ç½®çµ¦å·¦ä¸Šè§’çš„æµ®å‹•æŒ‰éˆ• */
        justify-content: flex-start; /* ç¢ºä¿æ¨™é¡Œé å·¦ */
    }

    /* Mobile: Sidebar è®Šæˆæµ®å‹•æŠ½å±œ */
    #sidebar {
        position: fixed;
        top: 50px;
        bottom: 0;
        left: 0;
        width: var(--sidebar-width);
        
        /* 3. â˜… ç¢ºä¿å®¹å™¨æœ¬èº«ä¸æ²å‹•ï¼Œåªè®“å…§éƒ¨çš„ scroll-area æ²å‹• */
        display: flex;
        flex-direction: column;
        overflow: hidden; 
        
        /* å…¶ä»–åŸæœ¬çš„æ¨£å¼... */
        background-color: var(--bg-panel);
        border-right: 1px solid var(--border-color);
        box-shadow: 2px 0 10px rgba(0,0,0,0.2);
        z-index: 100;
        transform: translateX(0);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Mobile: ç•¶ Sidebar é—œé–‰æ™‚ï¼Œç§»å‡ºç•«é¢ */
    body.sidebar-closed #sidebar {
        transform: translateX(-100%);
        width: var(--sidebar-width); /* ä¿æŒå¯¬åº¦ï¼Œåªæ˜¯ç§»å‡ºå»äº† */
    }

    .sidebar-scroll-area {
        /* 2. â˜… é—œéµä¿®æ­£ï¼šæ‰‹æ©Ÿç‰ˆåº•éƒ¨åŠ åš */
        /* é€™æ¨£å¯ä»¥ç¢ºä¿æœ€å¾Œä¸€å€‹æŒ‰éˆ•èƒ½è¢«ã€Œæ²å‹•ã€åˆ°æ‰‹æŒ‡é»å¾—åˆ°çš„åœ°æ–¹ï¼Œä¸æœƒè¢«ç€è¦½å™¨åº•ä¸‹çš„ bar æ“‹ä½ */
        padding-bottom: 100px; 
    }

    /* Mobile: å…§å®¹æ·¡å‡º */
    body.sidebar-closed .sidebar-scroll-area {
        opacity: 0; 
    }

    /* æ‰‹æ©Ÿç‰ˆæŒ‰éˆ•ï¼šæµ®åœ¨å·¦ä¸Šè§’ (Absolute/Fixed) */
    .sidebar-toggle {
        position: fixed;
        top: 5px;
        left: 10px;
        z-index: 101;
        margin: 0;
        background-color: transparent;
        
        /* â˜… é—œéµä¿®æ­£ï¼šå–æ¶ˆé›»è…¦ç‰ˆçš„å‚ç›´ç½®ä¸­åç§» */
        transform: none; 
    }
    /* â˜… æ–°å¢ï¼šç•¶å´é‚Šæ¬„æ‰“é–‹æ™‚ï¼Œåœ¨ä¸»ç•«é¢ä¸Šè“‹ä¸€å±¤åŠé€æ˜é»‘å¸ƒ 
       è§£é‡‹ï¼šbody:not(.sidebar-closed) ä»£è¡¨ã€Œå´é‚Šæ¬„é–‹å•Ÿæ™‚ã€
    */
    body:not(.sidebar-closed) .main-view::after {
        content: "";
        position: fixed; /* å¼·åˆ¶è¦†è“‹å…¨è¢å¹• */
        top: 0; left: 0; right: 0; bottom: 0;
        
        background-color: rgba(0, 0, 0, 0.4); /* 40% é€æ˜åº¦çš„é»‘è‰² */
        backdrop-filter: blur(2px); /* (é¸ç”¨) è®“èƒŒæ™¯ç¨å¾®æ¨¡ç³Šï¼Œè³ªæ„Ÿæ›´å¥½ */
        
        z-index: 99; /* å±¤ç´šè¨­å®šï¼š
                        Sidebar æ˜¯ 100
                        ToggleæŒ‰éˆ• æ˜¯ 101
                        æ‰€ä»¥é€™å€‹é®ç½© 99 æœƒå‰›å¥½è“‹ä½è¿·å®®ï¼Œä½†åœ¨é¸å–®ä¸‹é¢ */
        
        /* è®“é€™å±¤é®ç½©å¯ä»¥è¢«é»æ“Š */
        pointer-events: auto; 
        
        /* å¢åŠ æ·¡å…¥å‹•ç•« */
        animation: fadeInMask 0.3s ease;
    }
}

/* å®šç¾©æ·¡å…¥å‹•ç•« (å¦‚æœä½ çš„ CSS è£¡é‚„æ²’å®šç¾©é) */
@keyframes fadeInMask {
    from { opacity: 0; }
    to { opacity: 1; }
}

/* =========================================
   GitHub Button (Desktop Only)
   ========================================= */

/* 1. é è¨­ç‹€æ…‹ (æ‰‹æ©Ÿ)ï¼šéš±è— */
.desktop-only {
    display: none;
}

/* 2. é›»è…¦ç‰ˆæ¨£å¼ (è¢å¹•å¯¬åº¦å¤§æ–¼ 768px æ™‚é¡¯ç¤º) */
@media (min-width: 768px) {
    .desktop-only {
        display: flex; /* æ”¹ç‚ºé¡¯ç¤º */
        align-items: center;
        text-decoration: none; /* å»æ‰åº•ç·š */
        color: var(--text-color, #333); /* è·Ÿéš¨ä¸»é¡Œæ–‡å­—é¡è‰² */
        margin-left: 10px;
        padding: 5px 10px;
        border: 1px solid var(--border-color, #ccc);
        border-radius: 5px;
        transition: background-color 0.2s, color 0.2s;
        font-size: 0.9rem;
        background-color: var(--bg-card, #fff);
    }

    /* æ»‘é¼ æ‡¸åœæ•ˆæœ */
    .desktop-only:hover {
        background-color: var(--primary, #007bff);
        color: white;
        border-color: var(--primary, #007bff);
    }
    
    /* æ·±è‰²æ¨¡å¼é©é… (å¦‚æœä½ æœ‰å®šç¾© .dark-theme) */
    body.dark-theme .desktop-only {
        color: #ddd;
        border-color: #555;
        background-color: #333;
    }
    
    body.dark-theme .desktop-only:hover {
        background-color: var(--primary, #007bff);
        color: white;
    }
}